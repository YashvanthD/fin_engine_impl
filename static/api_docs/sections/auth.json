{
  "id": "auth",
  "name": "Authentication",
  "description": "User authentication and session management endpoints. All endpoints are under /api/auth/*",
  "baseUrl": "/api/auth",
  "endpoints": [
    {
      "id": "auth-signup",
      "method": "POST",
      "path": "/api/auth/signup",
      "summary": "Register admin user and create company account",
      "description": "Create the first admin user and company account. Requires master password for security.",
      "auth": false,
      "tags": ["registration", "admin"],
      "request": {
        "contentType": "application/json",
        "body": {
          "email": {"type": "string", "required": true, "description": "User email address", "example": "admin@example.com"},
          "password": {"type": "string", "required": true, "description": "User password (min 8 chars)", "example": "securepassword"},
          "name": {"type": "string", "required": true, "description": "Full name", "example": "John Doe"},
          "phone": {"type": "string", "required": false, "description": "Phone number", "example": "+1234567890"},
          "company_name": {"type": "string", "required": false, "description": "Company name", "example": "Fish Farm Inc"},
          "master_password": {"type": "string", "required": true, "description": "Server master password for registration"}
        },
        "example": {
          "email": "admin@example.com",
          "password": "securepassword",
          "name": "John Doe",
          "phone": "+1234567890",
          "company_name": "Fish Farm Inc",
          "master_password": "server_master_password"
        }
      },
      "responses": {
        "201": {
          "description": "Registration successful",
          "example": {
            "success": true,
            "data": {
              "user_id": "usr_abc123",
              "user_key": "usr_abc123",
              "account_key": "acc_xyz789",
              "message": "Admin signup validated and saved."
            }
          }
        },
        "400": {"description": "Validation error"},
        "403": {"description": "Invalid master password"},
        "409": {"description": "User already exists"}
      }
    },
    {
      "id": "auth-account-signup",
      "method": "POST",
      "path": "/api/auth/account/{account_key}/signup",
      "summary": "Create additional user in existing account",
      "description": "Create additional users in an existing account. Requires admin authentication.",
      "auth": true,
      "tags": ["registration", "admin"],
      "pathParams": {
        "account_key": {"type": "string", "required": true, "description": "Account key"}
      },
      "request": {
        "contentType": "application/json",
        "body": {
          "email": {"type": "string", "required": true, "description": "User email address"},
          "password": {"type": "string", "required": true, "description": "User password"},
          "name": {"type": "string", "required": true, "description": "Full name"},
          "role": {"type": "string", "required": true, "description": "User role (admin, manager, supervisor, worker)"},
          "authorities": {"type": "array", "required": false, "description": "Additional permissions/authorities"}
        },
        "example": {
          "email": "worker@example.com",
          "password": "password123",
          "name": "Jane Smith",
          "role": "worker",
          "authorities": ["VIEW_ALL_PONDS"]
        }
      },
      "responses": {
        "201": {
          "description": "User created",
          "example": {
            "success": true,
            "data": {
              "user_id": "usr_def456",
              "user_key": "usr_def456",
              "account_key": "acc_xyz789",
              "message": "User signup validated and saved."
            }
          }
        },
        "400": {"description": "Validation error"},
        "401": {"description": "Unauthorized - Invalid admin token"}
      }
    },
    {
      "id": "auth-login",
      "method": "POST",
      "path": "/api/auth/login",
      "summary": "Authenticate user and get tokens",
      "description": "Login with email/username/phone and password to receive JWT access and refresh tokens.",
      "auth": false,
      "tags": ["login"],
      "request": {
        "contentType": "application/json",
        "body": {
          "email": {"type": "string", "required": false, "description": "User email address"},
          "username": {"type": "string", "required": false, "description": "Username"},
          "phone": {"type": "string", "required": false, "description": "Phone number"},
          "password": {"type": "string", "required": true, "description": "User password"}
        },
        "example": {
          "email": "user@example.com",
          "password": "password123"
        }
      },
      "responses": {
        "200": {
          "description": "Login successful",
          "example": {
            "success": true,
            "data": {
              "user_key": "usr_abc123",
              "account_key": "acc_xyz789",
              "access_token": "eyJ...",
              "refresh_token": "eyJ...",
              "expires_in": 604800
            }
          }
        },
        "401": {"description": "Invalid credentials"}
      }
    },
    {
      "id": "auth-token",
      "method": "POST",
      "path": "/api/auth/token",
      "summary": "Generate access or refresh tokens",
      "description": "Generate new access token from refresh token or generate new refresh token with credentials.",
      "auth": false,
      "tags": ["token"],
      "request": {
        "contentType": "application/json",
        "body": {
          "type": {"type": "string", "required": false, "description": "Token type: 'access_token' or 'refresh_token'", "default": "access_token"},
          "token": {"type": "string", "required": false, "description": "Refresh token (if generating access token)"},
          "refresh_token": {"type": "string", "required": false, "description": "Alias for token"},
          "expires_in": {"type": "integer", "required": false, "description": "Token expiry in seconds"}
        },
        "example": {
          "type": "refresh_token",
          "token": "eyJ..."
        }
      },
      "responses": {
        "200": {
          "description": "Token generated",
          "example": {
            "success": true,
            "data": {
              "access_token": "eyJ...",
              "expires_in": 604800
            }
          }
        },
        "401": {"description": "Invalid or expired token"}
      }
    },
    {
      "id": "auth-refresh",
      "method": "POST",
      "path": "/api/auth/refresh",
      "summary": "Refresh access token",
      "description": "Get a new access token using a valid refresh token.",
      "auth": false,
      "tags": ["token"],
      "request": {
        "contentType": "application/json",
        "body": {
          "refreshToken": {"type": "string", "required": true, "description": "Valid refresh token"},
          "refresh_token": {"type": "string", "required": false, "description": "Alias for refreshToken"},
          "token": {"type": "string", "required": false, "description": "Alias for refreshToken"}
        },
        "example": {
          "refreshToken": "eyJ..."
        }
      },
      "responses": {
        "200": {
          "description": "Token refreshed",
          "example": {
            "success": true,
            "data": {
              "accessToken": "eyJ..."
            }
          }
        },
        "401": {"description": "Invalid or expired refresh token"}
      }
    },
    {
      "id": "auth-logout",
      "method": "POST",
      "path": "/api/auth/logout",
      "summary": "Logout and invalidate tokens",
      "description": "Invalidate the current access token and all associated refresh tokens.",
      "auth": true,
      "tags": ["logout"],
      "request": {},
      "responses": {
        "200": {
          "description": "Logout successful",
          "example": {"success": true, "data": {"message": "Logged out successfully", "success": true}}
        }
      }
    },
    {
      "id": "auth-me",
      "method": "GET",
      "path": "/api/auth/me",
      "summary": "Get current user info",
      "description": "Get the profile information of the currently authenticated user. Also supports POST method.",
      "auth": true,
      "tags": ["profile"],
      "request": {},
      "responses": {
        "200": {
          "description": "User info retrieved",
          "example": {
            "success": true,
            "data": {
              "user_key": "usr_abc123",
              "account_key": "acc_xyz789",
              "role": "admin",
              "authorities": ["VIEW_ALL_USERS"],
              "settings": {},
              "subscription": {},
              "last_active": "2026-01-15T10:30:00Z",
              "user": {
                "email": "user@example.com",
                "name": "John Doe"
              }
            }
          }
        },
        "404": {"description": "User not found"}
      }
    },
    {
      "id": "auth-validate",
      "method": "GET",
      "path": "/api/auth/validate",
      "summary": "Validate access token",
      "description": "Validate the current access token and return user info.",
      "auth": true,
      "tags": ["token"],
      "request": {},
      "responses": {
        "200": {
          "description": "Token is valid",
          "example": {
            "success": true,
            "data": {
              "user_key": "usr_abc123",
              "account_key": "acc_xyz789",
              "role": "admin"
            }
          }
        },
        "401": {"description": "Invalid or expired token"}
      }
    },
    {
      "id": "auth-account-users",
      "method": "GET",
      "path": "/api/auth/account/users",
      "summary": "List users in account",
      "description": "List all users in the current account. Requires manager/admin/owner role or VIEW_ALL_USERS permission.",
      "auth": true,
      "tags": ["users", "admin"],
      "request": {},
      "responses": {
        "200": {
          "description": "Users list",
          "example": {
            "success": true,
            "data": {
              "users": [
                {"user_key": "usr_abc123", "email": "admin@example.com", "name": "John Doe", "role": "admin"},
                {"user_key": "usr_def456", "email": "worker@example.com", "name": "Jane Smith", "role": "worker"}
              ]
            }
          }
        }
      }
    },
    {
      "id": "auth-settings",
      "method": "GET",
      "path": "/api/auth/settings",
      "summary": "Get user settings",
      "description": "Get the settings and subscription info of the currently authenticated user.",
      "auth": true,
      "tags": ["settings"],
      "request": {},
      "responses": {
        "200": {
          "description": "Settings retrieved",
          "example": {
            "success": true,
            "data": {
              "user_key": "usr_abc123",
              "account_key": "acc_xyz789",
              "settings": {"timezone": "UTC", "notifications": {}},
              "subscription": {"subscription_type": "free"}
            }
          }
        }
      }
    },
    {
      "id": "auth-settings-update",
      "method": "PUT",
      "path": "/api/auth/settings",
      "summary": "Update user settings",
      "description": "Update the settings of the currently authenticated user.",
      "auth": true,
      "tags": ["settings"],
      "request": {
        "contentType": "application/json",
        "body": {
          "settings": {"type": "object", "required": true, "description": "Settings object"}
        },
        "example": {
          "settings": {"timezone": "America/New_York", "notifications": {"email": true}}
        }
      },
      "responses": {
        "200": {"description": "Settings updated"}
      }
    },
    {
      "id": "auth-permissions",
      "method": "GET",
      "path": "/api/auth/permissions",
      "summary": "Get current user's permissions",
      "description": "Get the role and permissions of the currently authenticated user.",
      "auth": true,
      "tags": ["permissions"],
      "request": {},
      "responses": {
        "200": {
          "description": "Permissions retrieved",
          "example": {
            "success": true,
            "data": {
              "user_key": "usr_abc123",
              "role": "admin",
              "permissions": ["pond:create", "pond:read", "pond:update", "pond:delete"]
            }
          }
        }
      }
    },
    {
      "id": "auth-subscriptions",
      "method": "GET",
      "path": "/api/auth/subscriptions",
      "summary": "Get subscription info",
      "description": "Get the subscription information of the current user/account.",
      "auth": true,
      "tags": ["subscription"],
      "request": {},
      "responses": {
        "200": {
          "description": "Subscription info",
          "example": {
            "success": true,
            "data": {
              "user_key": "usr_abc123",
              "account_key": "acc_xyz789",
              "subscription": {"subscription_type": "premium", "expiry": "2027-01-15"}
            }
          }
        }
      }
    },
    {
      "id": "auth-subscriptions-update",
      "method": "PUT",
      "path": "/api/auth/subscriptions",
      "summary": "Update subscription (admin only)",
      "description": "Update the subscription for all users in the account. Requires admin role.",
      "auth": true,
      "tags": ["subscription", "admin"],
      "request": {
        "contentType": "application/json",
        "body": {
          "subscription": {"type": "object", "required": true, "description": "Subscription object"}
        },
        "example": {
          "subscription": {"subscription_type": "premium", "expiry": "2027-01-15"}
        }
      },
      "responses": {
        "200": {"description": "Subscription updated"}
      }
    },
    {
      "id": "auth-company",
      "method": "GET",
      "path": "/api/auth/account/{account_key}/company",
      "summary": "Get company name",
      "description": "Get the company name for a specific account.",
      "auth": true,
      "tags": ["company"],
      "pathParams": {
        "account_key": {"type": "string", "required": true, "description": "Account key"}
      },
      "request": {},
      "responses": {
        "200": {
          "description": "Company name",
          "example": {
            "success": true,
            "data": {"company_name": "Fish Farm Inc"}
          }
        },
        "404": {"description": "Company not found"}
      }
    }
  ]
}
